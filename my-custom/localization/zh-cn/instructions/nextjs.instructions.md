---
applyTo: "**"
description: "Next.js 最佳实践指南 (2025)"
---

# Next.js 最佳实践指南 (2025)

_最后更新：2025 年 7 月_

本文档总结了构建、组织和维护 Next.js 应用程序的最新权威最佳实践，旨在帮助开发者和 LLM 确保代码质量、可维护性和可扩展性。

---

## 1. 项目结构与组织

- **使用 `app/` 目录** (App Router) 进行所有新项目开发，优先于传统的 `pages/` 目录。
- **顶级文件夹：**
  - `app/` — 路由、布局、页面和路由处理器
  - `public/` — 静态资源 (图片、字体等)
  - `lib/` — 共享工具、API 客户端和逻辑
  - `components/` — 可重用的 UI 组件
  - `contexts/` — React 上下文提供者
  - `styles/` — 全局和模块化样式表
  - `hooks/` — 自定义 React hooks
  - `types/` — TypeScript 类型定义
- **文件共置：** 将文件 (组件、样式、测试) 放置在其使用位置附近，但避免过深的嵌套结构。
- **路由分组：** 使用括号 (例如 `(admin)`) 对路由进行分组，而不影响 URL 路径。
- **私有文件夹：** 使用 `_` 前缀 (例如 `_internal`) 排除路由并标记为实现细节。

- **功能文件夹：** 对于大型应用程序，按功能分组 (例如 `app/dashboard/`, `app/auth/`)。
- **使用 `src/`** (可选)：将所有源代码放入 `src/` 中，与配置文件分离。

## 2.1. 服务端与客户端组件集成 (App Router)

**不要在服务端组件中使用 `next/dynamic` 和 `{ ssr: false }`。** 这不被支持，会导致构建/运行时错误。

**正确方法：**

- 如果需要在服务端组件中使用客户端组件 (例如使用 hooks、浏览器 API 或客户端库的组件)，必须：
  1. 将所有仅客户端逻辑/UI 移动到专用的客户端组件 (顶部添加 `'use client'`)。
  2. 在服务端组件中直接导入并使用该客户端组件 (无需 `next/dynamic`)。
  3. 如果需要组合多个仅客户端元素 (例如带有配置文件下拉菜单的导航栏)，创建一个包含所有元素的单一客户端组件。

**示例：**

```tsx
// 服务端组件
import DashboardNavbar from "@/components/DashboardNavbar";

export default async function DashboardPage() {
  // ...服务端逻辑...
  return (
    <>
      <DashboardNavbar /> {/* 这是一个客户端组件 */}
      {/* ...其余服务端渲染的页面... */}
    </>
  );
}
```

**原因：**

- 服务端组件不能使用仅客户端功能或禁用 SSR 的动态导入。
- 客户端组件可以在服务端组件中渲染，但反之不行。

**总结：**
始终将仅客户端 UI 移动到客户端组件，并直接在服务端组件中导入。不要在服务端组件中使用 `next/dynamic` 和 `{ ssr: false }`。

---

**免责声明：** 本文档由 AI 翻译生成，仅供参考。请根据实际需求进行校对和修改。
