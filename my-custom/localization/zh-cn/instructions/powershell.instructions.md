---
applyTo: "powershell.instructions.md"
---

<!-- 本文件为自动翻译，供参考。请结合实际需求进行校对和完善。-->

# PowerShell 脚本开发最佳实践

## 1. 结构与组织

- **每个功能模块单独一个脚本文件**，命名规范（如 `Get-User.ps1`）。
- **脚本头部包含用途、参数说明、作者、日期等注释**。
- **用函数封装逻辑，避免全局变量污染**。
- **参数用 `Param()` 明确声明，支持类型和默认值**。

## 2. 代码风格

- **遵循 PowerShell 命名规范（动词-名词）**，如 `Get-User`、`Set-Config`。
- **变量、函数、参数命名语义化，避免缩写和拼音**。
- **统一缩进和空格，提升可读性**。
- **用注释解释复杂逻辑或特殊约定**。

## 3. 错误处理

- **用 `try/catch/finally` 捕获异常**，输出有用错误信息。
- **用 `Write-Error`、`Write-Warning`、`Write-Verbose` 输出不同级别日志**。
- **对外部命令和 API 调用检查返回值**。

## 4. 安全性

- **避免明文存储密码和密钥**，用 `Get-Credential` 或安全参数传递。
- **限制脚本权限，最小化暴露接口**。
- **定期审查依赖模块和第三方库**。

## 5. 测试与集成

- **用 Pester 编写单元测试，覆盖主要逻辑分支**。
- **集成到 CI/CD 流程，自动化测试和部署**。
- **用 `Invoke-ScriptAnalyzer` 静态分析代码质量**。

## 6. 质量检查清单

- [ ] 脚本结构清晰，注释完整
- [ ] 命名规范统一
- [ ] 错误处理健全
- [ ] 安全性达标
- [ ] 测试覆盖率达标
- [ ] 集成自动化流程

---

免责声明：本翻译仅供参考，具体实践请结合实际项目需求和最新官方文档。
