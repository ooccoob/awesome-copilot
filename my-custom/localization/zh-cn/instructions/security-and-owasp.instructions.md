---
applyTo: "security-and-owasp.instructions.md"
---

<!-- 本文件为自动翻译，供参考。请结合实际需求进行校对和完善。-->

# 安全编码与 OWASP 指南

## 指令

你的首要任务是确保所有生成、审查或重构的代码默认安全。始终以安全为先的思维方式工作，优先选择更安全的方案并说明理由。必须遵循以下基于 OWASP Top 10 和业界最佳实践的原则。

### 1. A01: 访问控制失效 & A10: 服务器端请求伪造（SSRF）

- **最小权限原则**：默认最严格权限。生成访问控制逻辑时，明确校验用户权限。
- **默认拒绝**：所有访问控制决策采用“默认拒绝”模式。
- **SSRF URL 校验**：服务器根据用户输入访问 URL 时，必须严格白名单校验主机、端口、路径。
- **防止路径遍历**：文件上传或访问时，必须净化输入，防止目录穿越攻击。

### 2. A02: 加密失效

- **强加密算法**：哈希优先用 Argon2、bcrypt，禁止 MD5、SHA-1 存储密码。
- **传输加密**：网络请求默认用 HTTPS。
- **存储加密**：敏感数据存储用 AES-256 等强加密。
- **安全密钥管理**：禁止硬编码密钥，建议用环境变量或密钥管理服务。
  ```javascript
  // GOOD: 从环境变量加载
  const apiKey = process.env.API_KEY;
  // TODO: 确保 API_KEY 已安全配置
  ```
  ```python
  # BAD: 硬编码密钥
  api_key = "sk_this_is_a_very_bad_idea_12345"
  ```

### 3. A03: 注入

- **禁止原始 SQL 拼接**，必须用参数化查询。
- **命令行输入净化**，用安全 API 防止 shell 注入。
- **防 XSS**：前端输出用户数据时，优先用 `.textContent`，如需 innerHTML 必须用 DOMPurify 等库净化。

### 4. A05: 配置不当 & A06: 组件漏洞

- **安全默认配置**，生产环境禁用详细错误和调试。
- **安全头**：建议加 CSP、HSTS、X-Content-Type-Options 等。
- **依赖安全**：新库用最新稳定版，定期用 `npm audit`、`pip-audit`、Snyk 扫描。

### 5. A07: 身份认证失效

- **安全会话管理**：登录后生成新 session id，cookie 加 HttpOnly、Secure、SameSite=Strict。
- **防暴力破解**：登录/重置密码接口建议加限流和锁定机制。

### 6. A08: 软件和数据完整性失效

- **防止不安全反序列化**，如需反序列化，优先用 JSON 并严格类型校验。

## 通用建议

- **安全显式说明**：每次用安全方案要说明防护点（如“此处用参数化查询防 SQL 注入”）。
- **代码审查时教育说明**：发现安全漏洞时，必须给出修正代码并解释原风险。

---

免责声明：本翻译仅供参考，具体实践请结合实际项目需求和最新官方文档。
