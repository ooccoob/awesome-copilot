---
description: "构建 Java 基础应用的指南"
applyTo: "**/*.java"
---

# Java 开发

> ⚠️ 本文件为自动翻译，仅供参考。请结合原文理解，如有歧义以英文原文为准。

## 通用说明

- 首先，建议用户在项目设置时是否集成静态分析工具（SonarQube、PMD、Checkstyle）。如需集成，请提供工具选择和配置指导。
- 如果用户不需要静态分析工具或希望跳过，继续执行下述最佳实践、Bug 模式和代码异味预防指南。
- 在开发过程中主动处理代码异味，避免技术债务积累。
- 重构时关注可读性、可维护性和性能。
- 利用 IDE/编辑器的警告和建议，及早发现常见问题。

## 最佳实践

- **Records**：对于主要用于存储数据的类（如 DTO、不可变数据结构），应优先使用 **Java Record** 而非传统类。
- **模式匹配**：使用 `instanceof` 和 `switch` 表达式的模式匹配，简化条件逻辑和类型转换。
- **类型推断**：本地变量声明可用 `var` 提高可读性，但仅在右侧表达式类型明确时使用。
- **不可变性**：优先使用不可变对象。尽可能将类和字段声明为 `final`。固定数据建议用 `List.of()`/`Map.of()`，用 `Stream.toList()` 创建不可变列表。
- **Streams 与 Lambda**：集合处理优先用 Streams API 和 Lambda 表达式，推荐方法引用（如 `stream.map(Foo::toBar)`）。
- **空值处理**：避免返回或接收 `null`。可用 `Optional<T>` 表示可缺失值，善用 `Objects` 工具类如 `equals()`、`requireNonNull()`。

### 命名规范

- 遵循 Google Java 风格指南：
  - 类/接口名用 `UpperCamelCase`
  - 方法/变量名用 `lowerCamelCase`
  - 常量用 `UPPER_SNAKE_CASE`
  - 包名用 `lowercase`
- 类名用名词（如 `UserService`），方法名用动词（如 `getUserById`）。
- 避免缩写和匈牙利命名法。

### Bug 模式

| 规则 ID | 描述                               | 示例/说明                                        |
| ------- | ---------------------------------- | ------------------------------------------------ |
| `S2095` | 资源应被关闭                       | 操作流、文件、Socket 等应使用 try-with-resources |
| `S1698` | 对象应用 `.equals()` 比较而非 `==` | 尤其是 String 和装箱类型                         |
| `S1905` | 冗余类型转换应移除                 | 清理不必要或不安全的类型转换                     |
| `S3518` | 条件不应恒为真/假                  | 警惕死循环或永远不变的 if 条件                   |
| `S108`  | 不可达代码应移除                   | return、throw 后的代码必须清理                   |

## 代码异味

| 规则 ID | 描述                 | 示例/说明                              |
| ------- | -------------------- | -------------------------------------- |
| `S107`  | 方法参数不宜过多     | 可拆分为辅助类或用构建器模式           |
| `S121`  | 应消除重复代码块     | 合并为共享方法                         |
| `S138`  | 方法不宜过长         | 拆分为更小、可测试的单元               |
| `S3776` | 应降低认知复杂度     | 简化嵌套逻辑、提取方法、避免深层 if 树 |
| `S1192` | 字符串字面量不应重复 | 用常量或枚举替代                       |
| `S1854` | 未使用的赋值应移除   | 避免死变量，建议移除或重构             |
| `S109`  | 魔法数字应用常量替代 | 提高可读性和可维护性                   |
| `S1188` | catch 块不应为空     | 异常应有日志或合理处理                 |

## 构建与验证

- 添加或修改代码后，确保项目能正常构建。
- Maven 项目请运行 `mvn clean install`。
- Gradle 项目请运行 `./gradlew build`（Windows 下为 `gradlew.bat build`）。
- 确保所有测试在构建过程中通过。
