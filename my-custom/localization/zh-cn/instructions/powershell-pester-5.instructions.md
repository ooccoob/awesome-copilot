---
applyTo: "powershell-pester-5.instructions.md"
---

<!-- 本文件为自动翻译，供参考。请结合实际需求进行校对和完善。-->

# PowerShell Pester 5 测试最佳实践

## 1. 结构与组织

- **每个功能模块单独一个测试文件**，命名为 `<模块名>.Tests.ps1`。
- **测试文件与被测脚本同级或同目录下的 `tests/` 文件夹**。
- **用 `Describe` 分组相关测试**，每个 `Describe` 针对一个功能点。
- **用 `Context` 细分不同场景或输入条件**。

## 2. 编写测试

- **用 `It` 定义单个可验证行为**，每个 `It` 只测一个断言。
- **断言用 `Should`，如 `| Should -Be`、`| Should -Match` 等**。
- **避免在测试中写业务逻辑，专注于输入输出验证**。
- **用 `BeforeAll`、`BeforeEach`、`AfterEach`、`AfterAll` 管理测试前后置操作**。

## 3. Mock 与依赖隔离

- **用 `Mock` 替换外部依赖（如 API、文件 IO）**，保证测试独立可重复。
- **验证 Mock 被调用次数和参数**。
- **避免 Mock 过多，优先测试真实逻辑**。

## 4. 运行与集成

- **用 `Invoke-Pester` 运行测试，推荐集成到 CI/CD 流程**。
- **测试应全部通过且无警告**。
- **用 `-CodeCoverage` 统计覆盖率，目标 80% 以上**。
- **失败用例应输出详细日志，便于排查**。

## 5. 质量检查清单

- [ ] 测试文件结构清晰，命名规范
- [ ] 每个 `It` 只测一个断言
- [ ] 断言表达准确，覆盖主要分支
- [ ] Mock 用于隔离外部依赖
- [ ] 覆盖率达标
- [ ] 集成到自动化流程

---

免责声明：本翻译仅供参考，具体实践请结合实际项目需求和最新官方文档。
