---
applyTo: "nodejs-javascript-vitest.instructions.md"
---

<!-- 本文件为自动翻译，供参考。请结合实际需求进行校对和完善。-->

# Node.js 与 JavaScript（Vitest）最佳实践

## 1. 代码结构与组织

- **推荐使用模块化结构**，将功能拆分为独立文件和文件夹。
- **入口文件**应命名为 `index.js` 或 `main.js`。
- **测试文件**应与被测代码同级，命名为 `*.spec.js` 或 `*.test.js`。
- **配置文件**（如 `vitest.config.js`、`.env`）应放在项目根目录。

## 2. 依赖管理

- **优先使用官方包管理器**（如 npm、yarn、pnpm）。
- **锁定依赖版本**，避免因依赖变动导致构建不一致。
- **定期运行 `npm audit` 或 `yarn audit`**，修复安全漏洞。
- **避免全局安装依赖**，除非有特殊需求。

## 3. 代码风格与质量

- **统一使用 ESLint 和 Prettier**，并在 CI 中强制检查。
- **遵循社区主流风格指南**（如 Airbnb、Standard）。
- **变量、函数、类命名应语义化**，避免缩写和拼音。
- **避免魔法数字和硬编码字符串**，使用常量或配置项。

## 4. 测试（Vitest）

- **所有新功能必须有单元测试和集成测试**。
- **测试覆盖率应达到 80% 以上**，并在 CI 中强制检查。
- **测试用例应独立、可重复、无副作用**。
- **优先使用模拟（mock）和依赖注入**，避免真实外部依赖。
- **测试命名应清晰描述行为和预期结果**。

## 5. 性能优化

- **避免同步阻塞操作**，优先使用异步 API。
- **合理使用缓存**，如内存缓存、Redis 等。
- **定期分析性能瓶颈**，使用如 `node --inspect`、`clinic.js` 等工具。
- **避免循环依赖和深层嵌套调用**。

## 6. 安全性

- **所有输入必须校验和消毒**，防止 XSS、SQL 注入等攻击。
- **敏感信息（如密钥、密码）不得硬编码**，应通过环境变量或安全配置管理。
- **依赖包需定期安全扫描**。
- **避免使用过时或不再维护的第三方库**。

## 7. 部署与运维

- **使用 `.env` 文件管理环境变量**，并在生产环境中加密敏感配置。
- **推荐使用 PM2、Docker 等工具进行进程和容器管理**。
- **日志应结构化输出，便于集中收集和分析**。
- **部署流程应自动化（CI/CD）**，并包含回滚机制。

## 8. 参考资料

- [Node.js 官方文档](https://nodejs.org/zh-cn/docs/)
- [Vitest 官方文档](https://vitest.dev/zh/)
- [ESLint 官方文档](https://eslint.org/)
- [Prettier 官方文档](https://prettier.io/)

---

免责声明：本翻译仅供参考，具体实践请结合实际项目需求和最新官方文档。
