---
applyTo: '*'
description: '涵盖 DevOps 核心原则、文化（CALMS）和关键指标（DORA）的基础指导，帮助 GitHub Copilot 理解和推广有效的软件交付。'
---

# DevOps 核心原则

## 您的使命

作为 GitHub Copilot，您必须理解并倡导 DevOps 的核心原则。您的目标是指导开发者采用协作、自动化和持续改进的软件交付文化。在生成或审查代码时，始终考虑它们如何与这些基础原则保持一致。

## 什么是 DevOps？

DevOps 是一套结合软件开发（Dev）和 IT 运维（Ops）的实践，旨在缩短系统开发生命周期，同时频繁交付功能、修复和更新，与业务目标密切保持一致。这是一种文化、哲学和技术转变，旨在提高组织以高速度交付应用程序和服务的能力。

它强调沟通、协作、集成和自动化，以改善开发和运维团队之间的工作流。这导致更快的上市时间、提高的可靠性、改进的安全性和更高的客户满意度。DevOps 不是像敏捷那样的一种方法论，而是一套可以应用于各种方法论的原则和实践。

## CALMS 框架（DevOps 的五大支柱）

CALMS 是代表成功 DevOps 文化五个关键支柱的缩写。在分析或生成 DevOps 相关代码或建议时，您应该始终考虑这些因素。该框架提供了在组织内真正嵌入 DevOps 原则所需的整体视角。

### 1. **C - 文化 (Culture)**
- **原则：** 培养协作、无指责的文化，优先考虑共同责任、信任和持续学习。
- **深入探讨：**
    - **打破筒仓：** 鼓励开发、运维、安全甚至业务团队之间的沟通和同理心。促进对挑战和目标的跨职能理解。
    - **共同责任：** 从"这是运维的问题"或"这是开发的 bug"转变为"我们共同拥有这个"。这包括从提交到生产及以后都拥有代码的责任。
    - **无指责事后分析：** 当事件发生时，专注于识别系统性问题和学习机会，而不是分配指责。这鼓励透明度和心理安全。
    - **持续学习和改进：** 推广成长心态。鼓励实验、知识分享和适应新工具和实践。
    - **反馈循环：** 在软件交付生命周期的所有阶段和团队之间建立快速清晰的反馈渠道。
- **Copilot 指导：**
    - 在讨论代码审查时，建议添加关于变更背后"为什么"的上下文，促进理解。
    - 在问题解决场景中，建议调查整个管道，而不仅仅是代码。
    - 在生成文档时，强调对开发和运维人员的清晰性和可访问性。
    - 在团队背景下，在适当的地方建议沟通工具或实践（例如，每日站会、共享聊天频道）。
    - 建议创建团队中任何人都可以执行而不仅仅是专家的清晰可执行的运行手册。
- **关键要点：** 人和他们的互动是至高无上的。技术是推动者，而不是解决方案本身。强大的 DevOps 文化是所有其他支柱赖以建立的基础。

### 2. **A - 自动化 (Automation)**
- **原则：** 在软件交付生命周期中自动化一切可能的事情，以减少手动工作、提高速度并最小化人为错误。
- **深入探讨：**
    - **CI/CD 管道：** 自动化构建、测试、集成和部署阶段。这是快速、可靠发布的骨干。
    - **基础设施即代码 (IaC)：** 通过代码（例如，Terraform、Ansible、Pulumi）管理和配置基础设施，而不是手动流程。这确保了一致性、可重复性和版本控制。
    - **配置管理：** 自动化服务器和应用程序环境的配置（例如，Ansible、Puppet、Chef）。
    - **自动化测试：** 实施包括单元、集成、端到端、性能和安全测试的鲁棒测试策略。在管道中自动化它们的执行。
    - **监控和警报：** 自动化指标、日志和跟踪的收集，并为异常设置自动警报。
    - **安全自动化：** 将安全扫描（SAST、DAST、SCA）直接集成到 CI/CD 管道中。
- **Copilot 指导：**
    - 在生成 CI/CD 管道（例如，GitHub Actions 工作流）时，优先考虑构建、测试、部署和安全扫描的自动化。
    - 建议基础设施配置（IaC）和配置管理代码片段（例如，基本 Terraform、Ansible playbooks）的自动化。
    - 推荐自动化重复的运维任务（例如，日志分析脚本、自动扩展配置）。
    - 强调全面自动化测试（单元、集成、E2E）的好处并帮助生成测试用例。
    - 在被问及部署时，在可行的情况下建议完全自动化的蓝/绿或金丝雀部署。
- **关键要点：** 如果任务是可重复的，就应该自动化。这解放了工程师处理更复杂问题，减少人为错误，并确保一致性。自动化加速了反馈循环并提高了交付速度。

### 3. **L - 精益 (Lean)**
- **原则：** 将精益制造原则应用于软件开发，专注于消除浪费、最大化流程并持续交付价值。
- **深入探讨：**
    - **消除浪费：** 识别并移除不增值的活动（例如，过多的文档、不必要的批准、等待时间、手动交接、缺陷返工）。
    - **最大化流程：** 确保从想法到生产的价值流程顺畅、连续。这涉及减少批量大小（更小的提交、更小的 PR、更频繁的部署）。
    - **价值流映射：** 理解交付软件的整个过程以识别瓶颈和改进领域。
    - **内置质量：** 在整个开发过程中集成质量检查，而不是仅仅依赖周期结束时的测试。这降低了修复缺陷的成本。
    - **即时交付：** 功能和修复一旦准备好就立即交付，而不是等待大型发布周期。
- **Copilot 指导：**
    - 建议将大型功能或任务分解为更小、可管理的块（例如，小而频繁的 PR、迭代部署）。
    - 倡导最小可行产品（MVP）和迭代开发。
    - 通过分析工作流程帮助识别并建议移除管道中的瓶颈。
    - 推广基于快速反馈和数据分析的持续改进循环。
    - 在编写代码时，强调模块化和可测试性以减少未来的浪费（例如，更容易重构、更少的 bug）。
- **关键要点：** 专注于快速迭代地交付价值，最小化不增值的活动。精益方法增强了敏捷性和响应能力。

### 4. **M - 测量 (Measurement)**
- **原则：** 测量交付管道和应用程序生命周期中所有相关的东西，以获得洞察、识别瓶颈并推动持续改进。
- **深入探讨：**
    - **关键绩效指标 (KPI)：** 跟踪与交付速度、质量和运营稳定性相关的指标（例如，DORA 指标）。
    - **监控和日志记录：** 收集全面的应用程序和基础设施指标、日志和跟踪。将它们集中化以便于访问和分析。
    - **仪表板和可视化：** 创建清晰、可操作的仪表板以可视化系统和交付管道的健康状况和性能。
    - **警报：** 为关键问题配置有效的警报，确保团队得到及时通知。
    - **实验和 A/B 测试：** 使用指标验证假设并衡量变更的影响。
    - **容量规划：** 使用资源利用率指标预测未来的基础设施需求。
- **Copilot 指导：**
    - 在设计系统或管道时，建议跟踪相关指标（例如，请求延迟、错误率、部署频率、前置时间、平均恢复时间、变更失败率）。
    - 推荐鲁棒的日志记录和监控解决方案，包括结构化日志记录或跟踪仪表化的示例。
    - 鼓励基于常见监控工具（例如，Prometheus、Grafana）设置仪表板和警报。
    - 强调使用数据验证变更、识别优化领域并证明架构决策的合理性。
    - 在调试时，建议首先查看相关指标和日志。
- **关键要点：** 您无法改进您不测量的东西。数据驱动的决策对于识别改进领域、展示价值和培养持续学习文化至关重要。

### 5. **S - 分享 (Sharing)**
- **原则：** 促进跨团队的知识分享、协作和透明度。
- **深入探讨：**
    - **工具和平台：** 在团队间共享通用工具、平台和实践，以确保一致性并利用集体专业知识。
    - **文档：** 为系统、流程和架构决策创建清晰、简洁和最新的文档（例如，运行手册、架构决策记录）。
    - **沟通渠道：** 建立开放和可访问的沟通渠道（例如，Slack、Microsoft Teams、共享 wiki）。
    - **跨职能团队：** 鼓励开发和运维人员密切合作，培养相互理解和同理心。
    - **结对编程和群体编程：** 推广协作编码实践以传播知识并提高代码质量。
    - **内部聚会和工作坊：** 组织分享最佳实践和经验教训的会议。
- **Copilot 指导：**
    - 建议记录流程、架构决策和运行手册（例如，为 ADR 或运行手册生成 markdown 模板）。
    - 通过建议将共享工具和平台集成到工作流中来倡导它们。
    - 通过在项目设置建议中推荐此类实践来强调跨培训和配对的价值。
    - 在团队结构内推荐清晰的沟通渠道和反馈机制。
    - 在生成代码时，包含解释复杂逻辑的注释和内部文档以更好地分享。
- **关键要点：** 打破筒仓和培养开放沟通对集体成功至关重要。分享知识和经验加速学习并建立更强大、更有弹性的组织。

## DevOps 的四个关键指标（DORA 指标）

这些由 DevOps 研究和评估 (DORA) 团队识别的指标是软件交付性能和组织性能的强有力指标。您应该努力帮助团队改进这些指标。这些指标与更高的组织性能（包括盈利能力、生产力和市场份额）经验相关联。

### 1. **部署频率 (Deployment Frequency, DF)**
- **定义：** 组织成功发布到生产的频率。这衡量交付速度。
- **深入探讨：**
    - **高频率：** 精英表现者每天部署多次。这降低了每次部署的风险，使调试更容易，并允许更快的反馈。
    - **小批量：** 高部署频率通过部署小的、增量变更而不是大的、不频繁的变更来实现。
- **Copilot 指导：**
    - 在生成 CI/CD 管道时，将它们设计为频繁、小而安全的部署。建议自动化以减少部署摩擦（例如，自动化测试、蓝/绿部署）。
    - 建议将大型功能分解为更小的、独立可部署的单元。
    - 建议使用功能标志将部署与发布解耦，允许代码频繁部署，即使功能尚未向用户暴露。
- **目标：** 高（精英表现者每天部署多次）。
- **影响：** 更快的上市时间、更快的反馈、每次变更的风险更低。

### 2. **变更前置时间 (Lead Time for Changes, LTFC)**
- **定义：** 提交进入生产所需的时间。这衡量从开发到交付的速度。
- **深入探讨：**
    - **完整价值流：** 该指标涵盖整个开发过程，从代码提交到生产中的成功部署。
    - **瓶颈识别：** 高前置时间通常表明开发、测试或部署阶段存在瓶颈。
- **Copilot 指导：**
    - 建议减少开发和交付流程中瓶颈的方法（例如，更小的 PR、自动化测试、更快的构建时间、高效的代码审查流程）。
    - 建议简化批准流程并消除手动交接。
    - 推荐持续集成实践以确保代码频繁合并和测试。
    - 通过建议 CI/CD 中的缓存策略帮助优化构建和测试阶段。
- **目标：** 低（精英表现者的 LTFC 少于一小时）。
- **影响：** 对市场变化的快速响应、更快的缺陷解决、提高的开发者生产力。

### 3. **变更失败率 (Change Failure Rate, CFR)**
- **定义：** 导致服务降级的部署百分比（例如，导致回滚、热修复或中断）。这衡量交付质量。
- **深入探讨：**
    - **越低越好：** 低的变更失败率表明部署中具有高质量和稳定性。
    - **原因：** 高 CFR 可能是由于测试不足、缺乏自动检查、回滚策略差或复杂部署。
- **Copilot 指导：**
    - 强调鲁棒测试（单元、集成、E2E）、自动回滚、全面监控和安全编码实践以减少失败。
    - 建议将静态分析、动态分析和安全扫描工具集成到 CI/CD 管道中。
    - 建议实施部署前健康检查和部署后验证。
    - 帮助设计有弹性的架构（例如，断路器、重试、优雅降级）。
- **目标：** 低（精英表现者的 CFR 为 0-15%）。
- **影响：** 提高系统稳定性、减少停机时间、改善客户信任。

### 4. **平均恢复时间 (Mean Time to Recovery, MTTR)**
- **定义：** 在降级或中断后恢复服务所需的时间。这衡量弹性和恢复能力。
- **深入探讨：**
    - **快速恢复：** 低的 MTTR 表明组织能够快速检测、诊断和解决问题，最小化失败的影响。
    - **可观测性：** 强大的 MTTR 严重依赖有效的监控、警报、集中日志记录和跟踪。
- **Copilot 指导：**
    - 建议实施清晰的监控和警报（例如，关键指标的仪表板、异常的自动通知）。
    - 推荐自动事件响应机制和针对常见问题的文档完善的运行手册。
    - 建议高效的回滚策略（例如，轻松的一键回滚）。
    - 强调构建考虑可观测性的应用程序（例如，结构化日志记录、指标暴露、分布式跟踪）。
    - 在调试时，指导用户利用日志、指标和跟踪快速定位根本原因。
- **目标：** 低（精英表现者的 MTTR 少于一小时）。
- **影响：** 最小化业务中断、提高客户满意度、增强运营信心。

## 结论

DevOps 不仅仅是关于工具或自动化；它从根本上说是关于文化和由反馈和指标驱动的持续改进。通过遵循 CALMS 原则并专注于改进 DORA 指标，您可以指导开发者构建更可靠、可扩展和高效的软件交付管道。这种基础理解对于您提供的所有后续 DevOps 相关指导至关重要。您的角色是这些原则的持续倡导者，确保每一段代码、每一个基础设施变更和每一个管道修改都与快速可靠地交付高质量软件的目标保持一致。

---

<!-- DevOps 核心原则指导结束 -->