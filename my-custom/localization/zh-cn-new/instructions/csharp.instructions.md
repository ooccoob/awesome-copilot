---
description: '构建 C# 应用程序的指南'
applyTo: '**/*.cs'
---

# C# 开发

## C# 指令
- 始终使用最新版本的 C#，目前是 C# 13 特性。
- 为每个函数编写清晰简洁的注释。

## 通用指令
- 在审查代码更改时只提出高置信度的建议。
- 编写具有良好可维护性实践的代码，包括对做出某些设计决策原因的注释。
- 处理边缘情况并编写清晰的异常处理。
- 对于库或外部依赖项，在注释中说明其用途和目的。

## 命名约定

- 组件名称、方法名称和公共成员使用 PascalCase。
- 私有字段和局部变量使用 camelCase。
- 接口名称以 "I" 为前缀（例如，IUserService）。

## 格式化

- 应用 `.editorconfig` 中定义的代码格式化样式。
- 优先使用文件作用域命名空间声明和单行 using 指令。
- 在任何代码块的左花括号前插入换行符（例如，在 `if`、`for`、`while`、`foreach`、`using`、`try` 等之后）。
- 确保方法的最终 return 语句在独立行上。
- 尽可能使用模式匹配和 switch 表达式。
- 引用成员名称时使用 `nameof` 而不是字符串字面量。
- 确保为任何公共 API 创建 XML 文档注释。适用时，在注释中包含 `<example>` 和 `<code>` 文档。

## 项目设置和结构

- 指导用户使用适当的模板创建新的 .NET 项目。
- 解释每个生成的文件和文件夹的用途，以建立对项目结构的理解。
- 演示如何使用功能文件夹或领域驱动设计原则来组织代码。
- 展示模型、服务和数据访问层的适当关注点分离。
- 解释 ASP.NET Core 9 中的 Program.cs 和配置系统，包括特定于环境的设置。

## 可空引用类型

- 将变量声明为不可空，并在入口点检查 `null`。
- 始终使用 `is null` 或 `is not null` 而不是 `== null` 或 `!= null`。
- 信任 C# null 注释，当类型系统说值不能为 null 时不要添加 null 检查。

## 数据访问模式

- 指导使用 Entity Framework Core 实现数据访问层。
- 解释开发和生产的不同选项（SQL Server、SQLite、内存中）。
- 演示存储库模式实现及其何时有益。
- 展示如何实现数据库迁移和数据种子设定。
- 解释高效查询模式以避免常见性能问题。

## 身份验证和授权

- 指导用户使用 JWT Bearer 令牌实现身份验证。
- 解释与 ASP.NET Core 相关的 OAuth 2.0 和 OpenID Connect 概念。
- 展示如何实现基于角色和基于策略的授权。
- 演示与 Microsoft Entra ID（前 Azure AD）的集成。
- 解释如何一致地保护基于控制器的 API 和最小 API。

## 验证和错误处理

- 指导使用数据注释和 FluentValidation 实现模型验证。
- 解释验证管道以及如何自定义验证响应。
- 演示使用中间件的全局异常处理策略。
- 展示如何为 API 创建一致的错误响应。
- 解释标准化错误响应的问题详情（RFC 7807）实现。

## API 版本控制和文档

- 指导用户实施和解释 API 版本控制策略。
- 演示具有适当文档的 Swagger/OpenAPI 实现。
- 展示如何记录端点、参数、响应和身份验证。
- 解释基于控制器的 API 和最小 API 中的版本控制。
- 指导用户创建有助于消费者的有意义的 API 文档。

## 日志记录和监控

- 指导使用 Serilog 或其他提供程序实施结构化日志记录。
- 解释日志记录级别以及何时使用每个级别。
- 演示与 Application Insights 的集成以收集遥测数据。
- 展示如何实现自定义遥测和用于请求跟踪的相关 ID。
- 解释如何监控 API 性能、错误和使用模式。

## 测试

- 始终为应用程序的关键路径包含测试用例。
- 指导用户创建单元测试。
- 不要发出 "Act"、"Arrange" 或 "Assert" 注释。
- 复制附近文件中的现有样式用于测试方法名称和大小写。
- 解释 API 端点的集成测试方法。
- 演示如何模拟依赖项以进行有效测试。
- 展示如何测试身份验证和授权逻辑。
- 解释应用于 API 开发的测试驱动开发原则。

## 性能优化

- 指导用户实施缓存策略（内存中、分布式、响应缓存）。
- 解释异步编程模式及其对 API 性能的重要性。
- 演示大数据集的分页、过滤和排序。
- 展示如何实施压缩和其他性能优化。
- 解释如何测量和基准测试 API 性能。

## 部署和 DevOps

- 指导用户使用 .NET 的内置容器支持（`dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer`）将 API 容器化。
- 解释手动 Dockerfile 创建和 .NET 的容器发布功能之间的差异。
- 解释 .NET 应用程序的 CI/CD 管道。
- 演示部署到 Azure App Service、Azure Container Apps 或其他托管选项。
- 展示如何实施健康检查和就绪探针。
- 解释不同部署阶段的特定环境配置。