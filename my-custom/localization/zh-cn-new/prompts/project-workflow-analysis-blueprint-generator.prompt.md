---

description: '全面的技术无关提示生成器，用于记录端到端应用程序工作流。自动检测项目架构模式、技术堆栈和数据流模式，生成详细的实现蓝图，涵盖入口点、服务层、数据访问、错误处理和测试方法，包括.NET、Java/Spring、React和微服务架构等多种技术。'

mode: 'agent'
---

# 项目工作流文档生成器

## 配置变量

```
${PROJECT_TYPE="自动检测|.NET|Java|Spring|Node.js|Python|React|Angular|微服务|其他"}
<!-- 主要技术堆栈 -->

${ENTRY_POINT="API|GraphQL|前端|CLI|消息消费者|计划作业|自定义"}
<!-- 工作流的起点 -->

${PERSISTENCE_TYPE="自动检测|SQL数据库|NoSQL数据库|文件系统|外部API|消息队列|缓存|无"}
<!-- 数据存储类型 -->

${ARCHITECTURE_PATTERN="自动检测|分层|Clean|CQRS|微服务|MVC|MVVM|无服务器|事件驱动|其他"}
<!-- 主要架构模式 -->

${WORKFLOW_COUNT=1-5}
<!-- 要记录的工作流数量 -->

${DETAIL_LEVEL="标准|实现就绪"}
<!-- 要包含的实现详细程度 -->

${INCLUDE_SEQUENCE_DIAGRAM=true|false}
<!-- 生成序列图 -->

${INCLUDE_TEST_PATTERNS=true|false}
<!-- 包含测试方法 -->
```

## 生成的提示

```
"分析代码库并记录${WORKFLOW_COUNT}个有代表性的端到端工作流，
这些工作流可以作为类似功能的实现模板。使用以下方法：
```

### 初始检测阶段

```
${PROJECT_TYPE == "自动检测" ?
  "首先检查代码库结构以识别技术：
   - 检查.NET解决方案/项目、Spring配置、Node.js/Express文件等
   - 识别使用的主要编程语言和框架
   - 根据文件夹结构和关键组件确定架构模式"
  : "专注于${PROJECT_TYPE}模式和约定"}
```

```
${ENTRY_POINT == "自动检测" ?
  "通过查找以下内容识别典型入口点：
   - API控制器或路由定义
   - GraphQL解析器
   - 发起网络请求的UI组件
   - 消息处理器或事件订阅者
   - 计划作业定义"
  : "专注于${ENTRY_POINT}入口点"}
```

```
${PERSISTENCE_TYPE == "自动检测" ?
  "通过检查以下内容确定持久化机制：
   - 数据库上下文/连接配置
   - 存储库实现
   - ORM映射
   - 外部API客户端
   - 文件系统交互"
  : "专注于${PERSISTENCE_TYPE}交互"}
```

### 工作流文档说明

对于系统中最具代表性的`${WORKFLOW_COUNT}`个工作流：

#### 1. 工作流概览
   - 提供工作流的名称和简要描述
   - 解释它服务的业务目的
   - 识别触发操作或事件
   - 列出完整工作流中涉及的所有文件/类

#### 2. 入口点实现

**API入口点：**
```
${ENTRY_POINT == "API" || ENTRY_POINT == "自动检测" ?
  "- 记录接收请求的API控制器类和方法
   - 显示包含属性/注解的完整方法签名
   - 包含完整的请求DTO/模型类定义
   - 记录验证属性和自定义验证器
   - 显示身份验证/授权属性和检查" : ""}
```

**GraphQL入口点：**
```
${ENTRY_POINT == "GraphQL" || ENTRY_POINT == "自动检测" ?
  "- 记录GraphQL解析器类和方法
   - 显示查询/变更的完整模式定义
   - 包含输入类型定义
   - 显示解析器方法实现及参数处理" : ""}
```

**前端入口点：**
```
${ENTRY_POINT == "前端" || ENTRY_POINT == "自动检测" ?
  "- 记录发起API调用的组件
   - 显示触发请求的事件处理器
   - 包含API客户端服务方法
   - 显示与请求相关的状态管理代码" : ""}
```

**消息消费者入口点：**
```
${ENTRY_POINT == "消息消费者" || ENTRY_POINT == "自动检测" ?
  "- 记录消息处理器类和方法
   - 显示消息订阅配置
   - 包含完整的消息模型定义
   - 显示反序列化和验证逻辑" : ""}
```

#### 3. 服务层实现
   - 记录涉及的每个服务类及其依赖项
   - 显示带有参数和返回类型的完整方法签名
   - 包含关键业务逻辑的实际方法实现
   - 记录适用的接口定义
   - 显示依赖注入注册模式

**CQRS模式：**
```
${ARCHITECTURE_PATTERN == "CQRS" || ARCHITECTURE_PATTERN == "自动检测" ?
  "- 包含完整的命令/查询处理器实现" : ""}
```

**Clean架构模式：**
```
${ARCHITECTURE_PATTERN == "Clean" || ARCHITECTURE_PATTERN == "自动检测" ?
  "- 显示用例/交互器实现" : ""}
```

#### 4. 数据映射模式
   - 记录DTO到域模型映射代码
   - 显示对象映射器配置或手动映射方法
   - 包含映射期间的验证逻辑
   - 记录映射期间创建的任何域事件

#### 5. 数据访问实现
   - 记录存储库接口及其实现
   - 显示带有参数和返回类型的完整方法签名
   - 包含实际查询实现
   - 记录带有所有属性的实体/模型类定义
   - 显示事务处理模式

**SQL数据库模式：**
```
${PERSISTENCE_TYPE == "SQL数据库" || PERSISTENCE_TYPE == "自动检测" ?
  "- 包含ORM配置、注解或Fluent API使用
   - 显示实际SQL查询或ORM语句" : ""}
```

**NoSQL数据库模式：**
```
${PERSISTENCE_TYPE == "NoSQL数据库" || PERSISTENCE_TYPE == "自动检测" ?
  "- 显示文档结构定义
   - 包含文档查询/更新操作" : ""}
```

#### 6. 响应构建
   - 记录响应DTO/模型类定义
   - 显示从域/实体模型到响应模型的映射
   - 包含状态码选择逻辑
   - 记录错误响应结构和生成

#### 7. 错误处理模式
   - 记录工作流中使用的异常类型
   - 显示每层的try/catch模式
   - 包含全局异常处理器配置
   - 记录错误日志实现
   - 显示重试策略或断路器模式
   - 包含失败场景的补偿操作

#### 8. 异步处理模式
   - 记录后台作业调度代码
   - 显示事件发布实现
   - 包含消息队列发送模式
   - 记录回调或webhook实现
   - 显示如何跟踪和监控异步操作

**测试方法（可选）：**
```
${INCLUDE_TEST_PATTERNS ?
  "9. **测试方法**
     - 记录每层的单元测试实现
     - 显示模拟模式和测试夹具设置
     - 包含集成测试实现
     - 记录测试数据生成方法
     - 显示API/控制器测试实现" : ""}
```

**序列图（可选）：**
```
${INCLUDE_SEQUENCE_DIAGRAM ?
  "10. **序列图**
      - 生成显示所有组件的详细序列图
      - 包含带参数类型的方法调用
      - 显示组件间的返回值
      - 记录条件流和错误路径" : ""}
```

#### 11. 命名约定
记录以下的一致模式：
- 控制器命名（例如：`EntityNameController`）
- 服务命名（例如：`EntityNameService`）
- 存储库命名（例如：`IEntityNameRepository`）
- DTO命名（例如：`EntityNameRequest`、`EntityNameResponse`）
- CRUD操作的方法命名模式
- 变量命名约定
- 文件组织模式

#### 12. 实现模板
为以下内容提供可重用的代码模板：
- 按照模式创建新API端点
- 实现新服务方法
- 添加新存储库方法
- 创建新域模型类
- 实现正确的错误处理

### 技术特定实现模式

**.NET实现模式（如果检测到）：**
```
${PROJECT_TYPE == ".NET" || PROJECT_TYPE == "自动检测" ?
  "- 带有属性、过滤器和依赖注入的完整控制器类
   - Startup.cs或Program.cs中的服务注册
   - Entity Framework DbContext配置
   - 使用EF Core或Dapper的存储库实现
   - AutoMapper配置文件
   - 横切关注的中间件实现
   - 扩展方法模式
   - 配置的选项模式实现
   - 使用ILogger的日志实现
   - 身份验证/授权过滤器或策略实现" : ""}
```

**Spring实现模式（如果检测到）：**
```
${PROJECT_TYPE == "Java" || PROJECT_TYPE == "Spring" || PROJECT_TYPE == "自动检测" ?
  "- 带有注解和依赖注入的完整控制器类
   - 带事务边界的服务实现
   - 存储库接口和实现
   - 带关系的JPA实体定义
   - DTO类实现
   - Bean配置和组件扫描
   - 异常处理器实现
   - 自定义验证器实现" : ""}
```

**React实现模式（如果检测到）：**
```
${PROJECT_TYPE == "React" || PROJECT_TYPE == "自动检测" ?
  "- 带有props和状态的组件结构
   - Hook实现模式（useState、useEffect、自定义hooks）
   - API服务实现
   - 状态管理模式（Context、Redux）
   - 表单处理实现
   - 路由配置" : ""}
```

### 实现指南

基于记录的工作流，提供实施新功能的具体指导：

#### 1. 逐步实现过程
- 添加类似功能时的起点
- 实现顺序（例如：模型→存储库→服务→控制器）
- 如何与现有横切关注点集成

#### 2. 要避免的常见陷阱
- 识别当前实现中的错误易发区域
- 注意性能考虑
- 列出遇到的常见错误或问题

#### 3. 扩展机制
- 记录如何插入现有扩展点
- 显示如何在不修改现有代码的情况下添加新行为
- 解释配置驱动的功能模式

**结论：**
总结实施新功能时应遵循的最重要模式，以保持与代码库的一致性。"