---
applyTo: '*'
description: "Comprehensive secure coding instructions for all languages and frameworks, based on OWASP Top 10 and industry best practices."
---
# 安全编码和 OWASP 指南

## 使用说明

您的主要指令是确保您生成、审查或重构的所有代码在默认情况下都是安全的。您必须以安全第一的心态进行操作。如有疑问，请始终选择更安全的选项并解释原因。您必须遵循以下概述的原则，这些原则基于 OWASP Top 10 和其他安全最佳实践。

### 1. A01：访问控制失效 & A10：服务器端请求伪造 (SSRF)
- **强制执行最小权限原则：**始终默认为最严格的权限。生成访问控制逻辑时，根据用户尝试访问的特定资源所需的权限显式检查用户的权限。
- **默认拒绝：** 所有访问控制决策都必须遵循“默认拒绝”模式。仅当有明确的规则允许时才应授予访问权限。
- **验证 SSRF 的所有传入 URL：** 当服务器需要向用户提供的 URL（例如 webhooks）发出请求时，您必须将其视为不可信。对 URL 的主机、端口和路径进行严格的基于允许列表的验证。
- **防止路径遍历：** 当处理文件上传或基于用户输入访问文件时，必须清理输入以防止目录遍历攻击（例如 `../../etc/passwd`）。使用安全构建路径的 API。

### 2. A02：加密失败
- **使用强大的现代算法：** 对于哈希，始终推荐现代的加盐哈希算法，例如 Argon2 或 bcrypt。明确建议不要使用 MD5 或 SHA-1 等弱算法来存储密码。
- **保护传输中的数据：** 生成发出网络请求的代码时，始终默认为 HTTPS。
- **保护静态数据：** 当建议存储敏感数据（PII、令牌等）的代码时，建议使用强大的标准算法（如 AES-256）进行加密。
- **安全秘密管理：**切勿对秘密进行硬编码（API 密钥、密码、连接字符串）。生成从环境变量或秘密管理服务（例如，HashiCorp Vault、AWS Secrets Manager）读取秘密的代码。包括清晰的占位符和注释。
  ```javascript
  // GOOD: Load from environment or secret store
  const apiKey = process.env.API_KEY; 
  // TODO: Ensure API_KEY is securely configured in your environment.
  ```
  ```python
  # BAD: Hardcoded secret
  api_key = "sk_this_is_a_very_bad_idea_12345" 
  ```

### 3. A03：注塑
- **无原始 SQL 查询：** 对于数据库交互，您必须使用参数化查询（准备好的语句）。切勿生成使用字符串连接或格式设置来根据用户输入构建查询的代码。
- **清理命令行输入：** 对于操作系统命令执行，请使用处理参数转义并防止 shell 注入的内置函数（例如 Python 中的 `shlex` ）。
- **防止跨站脚本 (XSS)：** 生成显示用户控制数据的前端代码时，必须使用上下文感知输出编码。优先选择默认将数据视为文本的方法 (`.textContent`)，而不是解析 HTML (`.innerHTML`) 的方法。当需要 `innerHTML` 时，建议首先使用 DOMPurify 等库来清理 HTML。

### 4. A05：安全配置错误 & A06：易受攻击的组件
- **默认配置安全：** 建议在生产环境中禁用详细错误消息和调试功能。
- **设置安全标头：** 对于 Web 应用程序，建议添加基本安全标头，例如 `Content-Security-Policy` (CSP)、`Strict-Transport-Security` (HSTS) 和 `X-Content-Type-Options`。
- **使用最新的依赖项：** 当要求添加新库时，建议最新的稳定版本。提醒用户运行 `npm audit`、`pip-audit` 或 Snyk 等漏洞扫描器来检查其项目依赖项中是否存在已知漏洞。

### 5. A07：身份认证失败
- **安全会话管理：** 当用户登录时，生成新的会话标识符以防止会话固定。确保会话 cookie 配置有 `HttpOnly`、`Secure` 和 `SameSite=Strict` 属性。
- **防止暴力破解：** 对于身份验证和密码重置流程，建议在一定次数的失败尝试后实施速率限制和帐户锁定机制。

### 6. A08：软件和数据完整性故障
- **防止不安全的反序列化：** 警告不要在未经适当验证的情况下反序列化来自不受信任来源的数据。如果需要反序列化，建议使用不易受到攻击的格式（例如 Python 中的 Pickle 上的 JSON）并实施严格的类型检查。

## 一般准则
- **明确说明安全性：**当您建议一段可以减轻安全风险的代码时，请明确说明您要防范的内容（例如，“在此处使用参数化查询来防止 SQL 注入。”）。
- **在代码审查期间进行教育：** 当您在代码审查中发现安全漏洞时，您不仅必须提供更正的代码，还必须解释与原始模式相关的风险。
