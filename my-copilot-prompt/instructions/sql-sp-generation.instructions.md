---
description: 'Guidelines for generating SQL statements and stored procedures'
applyTo: '**/*.sql'
---

# SQL开发

## 数据库模式生成
- 所有表名都应该是单数形式
- 所有列名称都应采用单数形式
- 所有表都应该有一个名为 `id` 的主键列
- 所有表都应该有一个名为 `created_at` 的列来存储创建时间戳
- 所有表都应该有一个名为 `updated_at` 的列来存储上次更新时间戳

## 数据库架构设计
- 所有表都应该有主键约束
- 所有外键约束都应该有一个名称
- 所有外键约束都应内联定义
- 所有外键约束都应该有 `ON DELETE CASCADE` 选项
- 所有外键约束都应该有 `ON UPDATE CASCADE` 选项
- 所有外键约束应引用父表的主键

## SQL 编码风格
- SQL 关键字使用大写（SELECT、FROM、WHERE）
- 对嵌套查询和条件使用一致的缩进
- 包括解释复杂逻辑的注释
- 将长查询分成多行以提高可读性
- 一致地组织子句（SELECT、FROM、JOIN、WHERE、GROUP BY、HAVING、ORDER BY）

## SQL 查询结构
- 在 SELECT 语句中使用显式列名而不是 SELECT *
- 使用多个表时用表名或别名限定列名
- 当可以使用连接时限制子查询的使用
- 包含 LIMIT/TOP 子句来限制结果集
- 对经常查询的列使用适当的索引
- 避免在 WHERE 子句中的索引列上使用函数

## 存储过程命名约定
- 在存储过程名称前添加“usp_”前缀
- 使用 PascalCase 命名存储过程
- 使用表明用途的描述性名称（例如 usp_GetCustomerOrders）
- 返回多个记录时包含复数名词（例如 usp_GetProducts）
- 返回单个记录时包含单数名词（例如，usp_GetProduct）

## 参数处理
- 参数前面加“@”
- 使用驼峰命名法作为参数名称
- 为可选参数提供默认值
- 使用前验证参数值
- 带注释的文档参数
- 一致地排列参数（先必需，后可选）


## 存储过程结构
- 包含带有描述、参数和返回值的标头注释块
- 返回标准化错误代码/消息
- 返回列顺序一致的结果集
- 使用 OUTPUT 参数返回状态信息
- 在临时表前添加“tmp_”前缀


## SQL 安全最佳实践
- 参数化所有查询以防止 SQL 注入
- 执行动态 SQL 时使用准备好的语句
- 避免在 SQL 脚本中嵌入凭据
- 实施正确的错误处理而不暴露系统详细信息
- 避免在存储过程中使用动态 SQL

## 交易管理
- 显式开始并提交事务
- 根据需求使用适当的隔离级别
- 避免锁定表的长时间运行事务
- 使用批处理进行大数据操作
- 包括 SET NOCOUNT ON 用于修改数据的存储过程
