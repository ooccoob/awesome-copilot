---
描述：“针对 TypeScript 5.x 和 ES2022 输出的 TypeScript 开发指南”
适用于：'**/*.ts'
---

# TypeScript 开发

> 这些说明假设项目是使用 TypeScript 5.x（或更高版本）编译到 ES2022 JavaScript 基线构建的。如果您的运行时需要较旧的语言目标或下级转译，请调整指导。

## 核心意图

- 尊重现有的架构和编码标准。
- 比起聪明的捷径，更喜欢可读的、明确的解决方案。
- 在发明新的抽象之前扩展当前的抽象。
- 优先考虑可维护性和清晰度、简短的方法和类、干净的代码。

## 通用护栏

- 以 TypeScript 5.x / ES2022 为目标，并且更喜欢原生功能而不是 polyfill。
- 使用纯ES模块；永远不要发出 `require`、`module.exports` 或 CommonJS 帮助程序。
- 除非另有要求，否则请依赖项目的构建、lint 和测试脚本。
- 当意图不明显时，请注意设计权衡。

## 项目组织

- 遵循存储库的文件夹和新代码的职责布局。
- 除非另有说明，否则请使用短横线大小写的文件名（例如 `user-session.ts`、`data-service.ts`）。
- 当有助于发现时，将测试、类型和助手放在其实现附近。
- 在添加新实用程序之前重用或扩展共享实用程序。

## 命名与风格

- 对类、接口、枚举和类型别名使用 PascalCase；其他一切都采用驼峰式命名法。
- 跳过 `I` 等接口前缀；依赖描述性名称。
- 根据事物的行为或领域含义来命名，而不是实现。

## 格式和风格

- 在提交之前运行存储库的 lint/format 脚本（例如 `npm run lint`）。
- 匹配项目的缩进、引用样式和尾随逗号规则。
- 保持职能聚焦；当逻辑分支增长时提取助手。
- 在实用时支持不可变数据和纯函数。

## 类型系统期望

- 避免 `any` （隐式或显式）；更喜欢 `unknown` 加上缩小。
- 对实时事件和状态机使用可区分联合。
- 集中共享合约而不是重复形状。
- 使用 TypeScript 实用程序类型（例如 `Readonly`、`Partial`、`Record`）表达意图。

## 异步、事件和错误处理

- 使用 `async/await`;包装在 try/catch 中等待，并出现结构化错误。
- 尽早保护边缘情况以避免深层嵌套。
- 通过项目的日志记录/遥测实用程序发送错误。
- 通过存储库的通知模式显示面向用户的错误。
- 消除配置驱动的更新并确定性地处置资源。

## 架构与模式

- 遵循存储库的依赖注入或组合模式；保持模块单一用途。
- 连接到生命周期时，请遵守现有的初始化和处置顺序。
- 通过清晰的接口保持传输层、域层和表示层的解耦。
- 添加服务时提供生命周期挂钩（例如 `initialize`、`dispose`）和有针对性的测试。

## 外部集成

- 在热路径之外实例化客户端并注入它们以实现可测试性。
- 切勿对秘密进行硬编码；从安全来源加载它们。
- 对网络或 IO 调用应用重试、退避和取消。
- 标准化外部响应并将错误映射到域形状。

## 安全实践

- 使用模式验证器或类型防护来验证和清理外部输入。
- 避免动态代码执行和不受信任的模板渲染。
- 在渲染 HTML 之前对不受信任的内容进行编码；使用框架转义或可信类型。
- 使用参数化查询或准备好的语句来阻止注入。
- 将机密保存在安全存储中，定期轮换它们，并请求最小权限范围。
- 支持敏感数据的不可变流和防御性副本。
- 仅使用经过审查的加密库。
- 及时修补依赖项并监控建议。

## 配置与秘密

- 通过共享助手进行配置并使用模式或专用验证器进行验证。
- 通过项目的安全存储处理机密；保护 `undefined` 和错误状态。
- 记录新的配置密钥并更新相关测试。

## 用户界面和用户体验组件

- 在渲染之前清理用户或外部内容。
- 保持 UI 层薄；将繁重的逻辑推送给服务或状态管理器。
- 使用消息传递或事件将 UI 与业务逻辑分离。

## 测试期望

- 使用项目的框架和命名风格添加或更新单元测试。
- 当行为跨模块或平台 API 时，扩展集成或端到端套件。
- 在提交之前运行有针对性的测试脚本以获得快速反馈。
- 避免脆弱的时序断言；更喜欢假定时器或注入时钟。

## 性能与可靠性

- 延迟加载大量依赖项并在完成后将其丢弃。
- 将昂贵的工作推迟到用户需要为止。
- 对高频事件进行批处理或去抖以减少抖动。
- 跟踪资源生命周期以防止泄漏。

## 文档和评论

- 将 JSDoc 添加到公共 API 中；如果有帮助，请包含 `@remarks` 或 `@example` 。
- 编写捕获意图的注释，并在重构期间删除陈旧的注释。
- 在引入重要模式时更新架构或设计文档。
