---
description: 'Guidelines for building REST APIs with ASP.NET'
applyTo: '**/*.cs, **/*.json'
---

# ASP.NET REST API 开发

## 说明
- 指导用户使用 ASP.NET Core 9 构建他们的第一个 REST API。
- 解释传统的 Web API 控制器和较新的 Minimal API 方法。
- 为每个实施决策提供教育背景，以帮助用户理解基本概念。
- 强调 API 设计、测试、文档和部署的最佳实践。
- 专注于提供解释以及代码示例，而不仅仅是实现功能。

## API 设计基础知识

- 解释 REST 架构原则以及它们如何应用于 ASP.NET Core API。
- 指导用户设计有意义的面向资源的 URL 和适当的 HTTP 动词用法。
- 演示传统的基于控制器的 API 和最小 API 之间的区别。
- 解释 REST 上下文中的状态代码、内容协商和响应格式。
- 帮助用户了解何时根据项目需求选择控制器与最小 API。

## 项目设置和结构

- 指导用户使用适当的模板创建新的 ASP.NET Core 9 Web API 项目。
- 解释每个生成的文件和文件夹的用途，以加深对项目结构的理解。
- 演示如何使用功能文件夹或领域驱动设计原则来组织代码。
- 显示模型、服务和数据访问层的关注点的正确分离。
- 解释 ASP.NET Core 9 中的 Program.cs 和配置系统，包括特定于环境的设置。

## 构建基于控制器的 API

- 使用正确的资源命名和 HTTP 动词实现来指导 RESTful 控制器的创建。
- 解释属性路由及其相对于传统路由的优点。
- 演示模型绑定、验证和 [ApiController] 属性的作用。
- 展示依赖注入如何在控制器中工作。
- 解释操作返回类型（IActionResult、ActionResult<T>、特定返回类型）以及何时使用每种类型。

## 实现最少的 API

- 指导用户使用最小 API 语法实现相同的端点。
- 解释端点路由系统以及如何组织路由组。
- 演示最小 API 中的参数绑定、验证和依赖项注入。
- 展示如何构建更大的 Minimal API 应用程序以保持可读性。
- 与基于控制器的方法进行比较和对比，以帮助用户理解差异。

## 数据访问模式

- 使用 Entity Framework Core 指导数据访问层的实现。
- 解释用于开发和生产的不同选项（SQL Server、SQLite、内存中）。
- 演示存储库模式的实现以及它何时有益。
- 展示如何实施数据库迁移和数据播种。
- 解释有效的查询模式以避免常见的性能问题。

## 认证与授权

- 指导用户使用 JWT 承载令牌实施身份验证。
- 解释与 ASP.NET Core 相关的 OAuth 2.0 和 OpenID Connect 概念。
- 展示如何实施基于角色和基于策略的授权。
- 演示与 Microsoft Entra ID（以前称为 Azure AD）的集成。
- 解释如何一致地保护基于控制器的 API 和最小 API。

## 验证和错误处理

- 使用数据注释和 FluentValidation 指导模型验证的实施。
- 解释验证管道以及如何自定义验证响应。
- 使用中间件演示全局异常处理策略。
- 展示如何在 API 中创建一致的错误响应。
- 解释标准化错误响应的问题细节 (RFC 7807) 实现。

## API 版本控制和文档

- 指导用户实施和解释 API 版本控制策略。
- 使用适当的文档演示 Swagger/OpenAPI 实现。
- 展示如何记录端点、参数、响应和身份验证。
- 解释基于控制器的 API 和最小 API 中的版本控制。
- 指导用户创建有意义的 API 文档来帮助消费者。

## 记录和监控

- 指导使用 Serilog 或其他提供程序实施结构化日志记录。
- 解释日志记录级别以及何时使用每个级别。
- 演示与 Application Insights 的集成以进行遥测收集。
- 展示如何实现自定义遥测和关联 ID 以进行请求跟踪。
- 解释如何监控 API 性能、错误和使用模式。

## 测试 REST API

- 指导用户为控制器、最小 API 端点和服务创建单元测试。
- 解释 API 端点的集成测试方法。
- 演示如何模拟依赖关系以进行有效测试。
- 展示如何测试身份验证和授权逻辑。
- 解释应用于 API 开发的测试驱动开发原则。

## 性能优化

- 指导用户实施缓存策略（内存中、分布式、响应缓存）。
- 解释异步编程模式以及它们为何对 API 性能如此重要。
- 演示大型数据集的分页、过滤和排序。
- 展示如何实施压缩和其他性能优化。
- 解释如何衡量和基准 API 性能。

## 部署和 DevOps

- 指导用户使用 .NET 的内置容器支持 (`dotnet publish --os linux --arch x64 -p:PublishProfile=DefaultContainer`) 将其 API 容器化。
- 解释手动 Dockerfile 创建和 .NET 容器发布功能之间的差异。
- 解释 ASP.NET Core 应用程序的 CI/CD 管道。
- 演示到 Azure 应用服务、Azure 容器应用或其他托管选项的部署。
- 展示如何实施健康检查和就绪探测。
- 解释不同部署阶段的特定于环境的配置。
