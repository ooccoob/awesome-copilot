# DFRobot FIT0127 LCD字符显示仿真规范

## 概述

本文档详细说明了如何**模拟 DFRobot FIT0127 LCD 字符显示模块**。 FIT0127 是一款 **16x2 字符 LCD**，与 **HD44780 控制器** 兼容，常用于 6502 和微控制器面包板系统。

目标是 SBC 仿真器、固件测试和 UI 可视化的**功能正确性**，而不是电信号模拟。

---

## 模块摘要

|特色 |价值|
| ---------------- | ----------------------- |
|显示类型 |字符液晶|
|分辨率| 16 列 x 2 行 |
|控制器| HD44780 兼容 |
|接口 | 8 位或 4 位并行 |
|字符矩阵| 5x8 点 |
|电源电压| 5V |

---

## 引脚定义

|针 |名称 |功能|
| ---- | ----- | ---------------- |
| 1 |接地 |地面|
| 2 | VCC | +5V |
| 3 |画外音 |对比度控制|
| 4 | RS |注册 选择 |
| 5 |读/写 |读/写|
| 6 |电子|启用 |
| 7-14 | D0-D7 |数据总线|
| 15 | 15一个 |背光+|
| 16 | 16克 |背光-|

---

## 逻辑寄存器

| RS |注册 |
| -- | -------------------- |
| 0 |指令寄存器|
| 1 |数据寄存器|

---

## 指令集（子集）

|命令 |代码|描述 |
| --------------- | ----------- | ------------------------- |
|清晰显示 | __代码0__ |清除 DDRAM，光标主页 |
|返回首页 | __代码0__ |光标到起始位置 |
|进入模式设置 | __代码0__ |光标方向 |
|显示控制| __代码0__ |显示、光标、闪烁 |
|光标/移动 | __代码0__ |移动光标/显示|
|功能设置| __代码0__ |数据长度，行|
|设置 CGRAM 地址 | __代码0__ |自定义字符 |
|设置 DDRAM 地址 | __代码0__ |光标位置|

---

## 内存模型

### DDRAM（显示数据RAM）

* 大小：80 字节
* 第 1 行碱基：`0x00`
* 第 2 行碱基：`0x40`

模拟器映射：

```text
Row 0: DDRAM[0x00-0x0F]
Row 1: DDRAM[0x40-0x4F]
```

### CGRAM（字符生成器 RAM）

* 最多可存储 8 个自定义字符
* 每个字符 8 个字节

---

## 数据写入周期

写入发生在以下情况：

```
RS = 1
R/W = 0
E: HIGH  LOW
```

### 模拟器行为

* 在 `E` 的下降沿，锁存数据
* 根据地址模式将数据写入DDRAM或CGRAM
* 根据输入模式自动递增或递减地址

---

## 指令写周期

在以下情况下会发生命令写入：

```
RS = 0
R/W = 0
E: HIGH  LOW
```

---

## 读取周期（可选）

读取在爱好系统中并不常见。

```
RS = 0/1
R/W = 1
E: HIGH
```

模拟器可以简化：

* 完全忽略读取
* 或者返回忙标志+地址计数器

---

## 忙旗模拟

### 真实硬件

* 忙标志=D7
* 命令需要 37-1520 µs

### 模拟器选项

|模式|行为 |
| ---------- | ----------------- |
|简化 |时刻准备着|
|定时 |忙N个周期|

推荐默认值：**始终准备就绪**

---

## 上电状态

复位时：

* 显示关闭
* 光标关闭
* DDRAM 已清除或未定义
* 地址计数器 = 0

模拟器应该：

* 清除显存
* 将光标设置为 (0,0)
* 显示已启用

---

## 光标和显示模型

状态变量：

```text
cursor_row
cursor_col
display_on
cursor_on
blink_on
```

根据输入模式写入后光标自动移动。

---

## 4 位与 8 位接口

### 8位模式

* 在 D0-D7 上传输的完整字节

### 4 位模式

* 首先发送高半字节
* 每字节两个使能脉冲

模拟器简化：

* 接受全字节写入
* 忽略半字节时序

---

## 渲染模型（模拟器 UI）

推荐方法：

* 维护 16x2 字符缓冲区
* 渲染 ASCII 子集
* 替换不受支持的字形
* 可选择渲染自定义 CGRAM 字符

---

## 模拟器 API 模型

```c
typedef struct {
    uint8_t ddram[80];
    uint8_t cgram[64];
    uint8_t addr;
    bool display_on;
    bool cursor_on;
    bool blink_on;
    uint8_t entry_mode;
} FIT0127_LCD;
```

---

## 6502 系统中的常见接线

```
VIA Port  LCD D4-D7 (4-bit mode)
RS  VIA bit
E   VIA bit
R/W  GND
```

---

## 测试清单

* 清除显示命令
* 通过 DDRAM 地址进行光标定位
* 连续字符写入
* 换行行为
* 自定义字符显示

---

## 参考文献

* [HD44780U 数据表 (日立)](https://academy.cba.mit.edu/classes/output_devices/44780.pdf)
* [Ben Eater LCD 接口说明](https://hackaday.io/project/174128-db6502/log/181838-adventures-with-hd44780-lcd-controller)
* [Ben Eater 的 6502 计算机](https://github.com/tedkotz/be6502)
* [构建 6502 计算机](https://eater.net/6502)

---

## 注释

该规范有意优先考虑**固件可见行为**而不是电气精度，使其成为以下应用的理想选择：

* SBC仿真器
* ROM和监视器开发
* LCD输出的自动测试
* 教育CPU项目
