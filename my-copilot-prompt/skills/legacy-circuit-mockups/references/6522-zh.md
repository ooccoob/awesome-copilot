# MOS Technology 6522 多功能接口适配器 (VIA)

## 1. 概述

**MOS Technology 6522 VIA** 是一款通用 I/O 控制器，旨在将 6502 系列微处理器与外部外设连接起来。它于 20 世纪 70 年代中期推出，提供并行 I/O 端口、定时器、移位寄存器支持和中断处理。 6522 广泛应用于 Commodore PET、VIC-20、Apple II、BBC Micro 和许多基于 6502 的嵌入式设计等系统中。

---

## 2. 一般特征

|特色|描述 |
| -------------- | -------------------------------- |
|数据宽度| 8 位 |
|寻址 |内存映射 I/O |
|寄存器 | 16（4 位寄存器选择）|
| I/O 端口 |两个 8 位端口（端口 A、端口 B）|
|定时器|两个 16 位定时器 |
|移位寄存器| 8 位串行 I/O |
|中断 |可屏蔽，多个来源 |
|时钟|系统时钟（φ2）|

---

## 3. 引脚功能（逻辑）

### 3.1 A口（PA0-PA7）

* 8位双向并行I/O
* 通过 CA1 / CA2 握手支持

### 3.2 B口（PB0-PB7）

* 8位双向并行I/O
* 通过 CB1 / CB2 支持握手
* PB6和PB7可以由定时器1控制

### 3.3 控制引脚

|针 |描述 |
| --------- | ------------------------------------- |
| CA1 / CB1 |具有中断功能的控制输入
| CA2 / CB2 |握手/脉冲/中断引脚|
|中断请求|中断请求输出（低电平有效）|
|重置 |重置输入|

---

## 4. 注册地图

使用 4 条地址线 (RS0-RS3) 选择寄存器。基地址是系统定义的。

|偏移|注册 |描述 |
| -----: | --------- | ------------------------------------ |
|     0 美元 | ORB |输出寄存器B |
|     1 美元 |奥拉/IRB |输出寄存器 A / 输入寄存器 B |
|     2 美元 | DDRB |数据方向寄存器B |
|     3 美元 | DDRA |数据方向寄存器A|
|     4 美元 | T1C-L |定时器 1 计数器低 |
|     5 美元 | T1C-H |定时器 1 计数器高 |
|     6 美元 | T1L-L |定时器 1 锁存低电平 |
|     7 美元 | T1L-H |定时器 1 锁存高电平 |
|     8 美元 | T2C-L |定时器 2 计数器低 |
|     9 美元 | T2C-H |定时器 2 计数器高 |
|     $A | SR |移位寄存器|
|     $B | ACR |辅助控制寄存器|
|     $C |聚合酶链反应 |外设控制寄存器|
|     $D |仪表飞行规则 |中断标志寄存器|
|     $E | IER |中断使能寄存器|
|     $F |奥拉 / 爱尔兰共和军 |输出寄存器 A / 输入寄存器 A |

---

## 5. 数据方向寄存器（DDRA/DDRB）

每个位控制其相应端口引脚的方向：

* `0` = 输入
* `1` = 输出

```text
DDRB bit = 1  PBx is output
DDRB bit = 0  PBx is input
```

---

## 6. 定时器

### 6.1 定时器1（T1）

* 16位递减计数器
* 可以在一次性或自由运行模式下运行
* 可以在超时时切换 PB7
* 产生中断

### 6.2 定时器2（T2）

* 16位递减计数器
* 支持PB6上的脉冲计数
* 仅一键操作

---

## 7. 移位寄存器（SR）

* 8位移位寄存器
* 可以将数据移入或移出
* 可通过 ACR 选择时钟源
* 常用于串行通信或键盘扫描

---

## 8. 控制寄存器

### 8.1 辅助控制寄存器（ACR）

|位|功能|
| --: | ---------------------------------- |
|   7 |定时器1控制（PB7输出）|
|   6 |定时器 1 模式（自由运行/一次性）|
|   5 |定时器2控制|
|   4 |移位寄存器模式 |
|   3 |移位寄存器时钟源|
|   2 |端口 B 锁存 |
|   1 |端口 A 锁存 |
|   0 |未使用 |

### 8.2 外设控制寄存器（PCR）

控制 CA1、CA2、CB1、CB2 行为：

* 输入/输出模式
* 主动边缘选择
* 脉冲或握手模式

---

## 9. 中断系统

### 9.1 中断标志寄存器（IFR）

|位|来源 |
| --: | ---------------------------------- |
|   7 | IRQ 状态（任何已启用的中断）|
|   6 |定时器1 |
|   5 |定时器2 |
|   4 | CB1 |
|   3 | CB2 |
|   2 |移位寄存器|
|   1 | CA1 |
|   0 | CA2 |

### 9.2 中断允许寄存器（IER）

* 位 7 决定设置/清除模式：

  * `1` = 设置位
  * `0` = 清除位

```text
Write $80 | mask  enable interrupts
Write $00 | mask  disable interrupts
```

---

## 10. 重置行为

复位时：

* 所有 DDR 位均被清除（端口默认为输入）
* 计时器停止
* 移位寄存器禁用
* 中断禁用

---

## 11. 计时说明

* VIA 寄存器与 φ2 同步访问
* 定时器计数器每 φ2 周期递减一次
* 某些操作在读/写寄存器时会产生副作用

---

## 12. 常见用例

* 键盘和操纵杆接口
* 并行打印机接口
* 定时器和事件计数
* 简单的串行通信
* 通用GPIO扩展

---

## 13. 变体和相关芯片

|芯片|笔记|
| ----- | ----------------------------- |
| 6522 |原装NMOS VIA |
| 65C22 | 65C22 CMOS VIA，速度更快，功耗更低 |
| 6520 |早期的 PIA（更简单）|

---

## 14. 参考文献

* __自动0__
* __自动0__

---
